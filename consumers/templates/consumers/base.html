{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Waterworks{% endblock %}</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
                        success: { 50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 800: '#166534', 900: '#14532d' },
                        danger: { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' },
                        warning: { 50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f' },
                        info: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' },
                        dark: { 50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db', 400: '#9ca3af', 500: '#6b7280', 600: '#4b5563', 700: '#374151', 800: '#1f2937', 900: '#111827' },
                        light: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4', 400: '#a3a3a3', 500: '#737373', 600: '#525252', 700: '#404040', 800: '#262626', 900: '#171717' }
                    }
                }
            }
        }
    </script>
    <!-- Bootstrap Icons (keeping for icon compatibility) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- SweetAlert2 for Beautiful Alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Custom Button Styles */
        .btn-primary {
            background-color: #2563eb;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Loading Overlay */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        #loadingOverlay.active {
            display: flex;
        }

        /* Dropdown Animation */
        .dropdown-menu {
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Dropdown Styles */
        .dropdown {
            position: relative;
        }

        .dropdown-toggle::after {
            display: none;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            margin-top: 0.5rem;
            min-width: 220px;
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #374151;
            text-decoration: none;
        }

        .dropdown-item:hover {
            background-color: #f3f4f6;
            color: #dc2626;
        }

        .dropdown-divider {
            height: 0;
            margin: 0.5rem 0;
            overflow: hidden;
            border-top: 1px solid #e5e7eb;
        }

        /* Print Styles */
        @media print {
            .sidebar,
            #sidebar,
            .header-bar {
                display: none !important;
            }

            .main-content,
            #main-content {
                margin-left: 0 !important;
                padding: 0 !important;
            }

            body {
                margin: 0 !important;
                padding: 0 !important;
            }
        }
    </style>
</head>
<body class="bg-light-100" id="main-body">

    <!-- Header Bar -->
    <div class="header-bar bg-white fixed top-0 left-0 right-0 flex items-center justify-between px-3 shadow-sm border-b border-light-300" style="height: 50px; z-index: 1030;">
        <div class="flex items-center gap-2">
            <img src="{% static 'consumers/images/water_icon.png' %}" alt="Logo" class="rounded-full border-2 border-primary-500" style="width: 32px; height: 32px;">
            <h1 class="mb-0 font-bold text-dark-900 text-base">Balilihan Waterworks</h1>
        </div>

        <!-- User Profile Dropdown -->
        <div class="dropdown">
            <button class="dropdown-toggle flex items-center gap-2 p-0 border-0 bg-transparent cursor-pointer"
                    type="button"
                    id="userDropdown"
                    onclick="toggleDropdown('userDropdown', event)">
                <!-- Admin Icon with Letter A -->
                <div class="flex items-center justify-center w-9 h-9 rounded-full text-white font-bold text-lg shadow-md"
                     style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                    A
                </div>
                <!-- Admin Text -->
                <span class="text-dark-900 text-sm font-semibold">Admin</span>
            </button>
            <div class="dropdown-menu" id="userDropdown-menu">
                <div class="px-3 py-2 border-b border-light-300">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="flex items-center justify-center w-12 h-12 rounded-full text-white font-bold text-xl shadow-md"
                             style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                            A
                        </div>
                        <div class="flex-1">
                            <div class="font-bold text-dark-900">{{ request.user.get_full_name|default:request.user.username }}</div>
                            <div class="text-xs text-dark-500">Administrator</div>
                        </div>
                    </div>
                    <div class="text-xs text-dark-500">{{ request.user.email|default:"No email" }}</div>
                </div>
                <a class="dropdown-item" href="{% url 'consumers:staff_logout' %}">
                    <i class="bi bi-box-arrow-right text-danger-600"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar bg-white text-dark-900 fixed left-0 bottom-0 flex flex-col py-2 px-2 border-r border-light-300"
         style="width: 220px; top: 50px; z-index: 1020; box-shadow: 2px 0 10px rgba(0,0,0,0.05);"
         id="sidebar">
        <nav class="flex-grow overflow-y-auto scrollbar-thin">
            <!-- Main Section -->
            <div class="nav-section mb-2">
                <div class="text-dark-500 uppercase font-semibold mb-1.5 text-xxs tracking-wider px-2" style="font-size: 0.65rem;">Main</div>
                <a href="{% url 'consumers:home' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-house-door-fill me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">Dashboard</span>
                </a>
            </div>

            <!-- Consumer Operations -->
            <div class="nav-section mb-2">
                <div class="text-dark-500 uppercase font-semibold mb-1.5 text-xxs tracking-wider px-2" style="font-size: 0.65rem;">Consumer Ops</div>
                <a href="{% url 'consumers:consumer_management' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-people-fill me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">Consumers</span>
                </a>
                <a href="{% url 'consumers:inquire' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <span class="me-2.5 text-base font-bold" style="width: 20px; text-align: center;">â‚±</span>
                    <span class="font-medium">Bill Inquiry</span>
                </a>
                <a href="{% url 'consumers:meter_readings' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-speedometer2 me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">Meter Readings</span>
                </a>
            </div>

            <!-- Reports & System -->
            <div class="nav-section mb-2">
                <div class="text-dark-500 uppercase font-semibold mb-1.5 text-xxs tracking-wider px-2" style="font-size: 0.65rem;">Reports & System</div>
                <a href="{% url 'consumers:reports' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-file-earmark-text-fill me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">Reports</span>
                </a>
                <a href="{% url 'consumers:system_management' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-gear-fill me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">System Settings</span>
                </a>
            </div>

            <!-- Administration (Superuser Only) -->
            {% if user.is_superuser %}
            <div class="nav-section mb-2">
                <div class="text-dark-500 uppercase font-semibold mb-1.5 text-xxs tracking-wider px-2" style="font-size: 0.65rem;">Administration</div>
                <a href="{% url 'consumers:admin_verification' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-shield-lock-fill me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">User Management</span>
                </a>
                <a href="{% url 'consumers:user_login_history' %}"
                   class="nav-link-modern flex items-center text-dark-900 no-underline py-2 px-2.5 rounded-lg mb-0.5 transition-all duration-200 hover:bg-light-100 hover:text-primary-600 text-sm">
                    <i class="bi bi-clock-history me-2.5 text-base" style="width: 20px;"></i>
                    <span class="font-medium">Login History</span>
                </a>
            </div>
            {% endif %}
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content min-h-screen p-5" style="margin-left: 220px; margin-top: 50px; overflow-y: auto;" id="main-content">
        {% block main_content %}
        <div class="card p-4 mt-3">
            <h3 class="mb-3 text-2xl font-bold">Welcome, {{ request.user.username }}</h3>
            <p class="text-dark-500">Select a menu from the sidebar to start.</p>
        </div>
        {% endblock %}
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay">
        <div class="text-center text-white">
            <div class="spinner inline-block mb-3" role="status"></div>
            <p class="mt-3">Loading...</p>
        </div>
    </div>

    <!-- Utility Scripts -->
    <script>
        // Dropdown toggle function
        function toggleDropdown(id, event) {
            // Prevent event bubbling
            if (event) {
                event.stopPropagation();
            }

            const menu = document.getElementById(id + '-menu');
            const dropdown = document.getElementById(id);

            // Close all other dropdowns first
            document.querySelectorAll('.dropdown-menu.show').forEach(m => {
                if (m.id !== id + '-menu') {
                    m.classList.remove('show');
                }
            });

            // Toggle current dropdown
            menu.classList.toggle('show');

            // Close dropdown when clicking outside (delayed to prevent immediate trigger)
            if (menu.classList.contains('show')) {
                setTimeout(() => {
                    document.addEventListener('click', function closeDropdown(e) {
                        if (!dropdown.contains(e.target)) {
                            menu.classList.remove('show');
                            document.removeEventListener('click', closeDropdown);
                        }
                    });
                }, 10);
            }
        }

        // Loading overlay utility
        function showLoading(message = 'Loading...') {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('active');
            overlay.querySelector('p').textContent = message;
        }

        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.remove('active');
        }

        // Toast notification using SweetAlert2
        function showToast(type, message, duration = 3000) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: duration,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });

            Toast.fire({
                icon: type,
                title: message
            });
        }

        // Confirmation dialog
        function confirmAction(title, text, confirmText = 'Yes, proceed!', type = 'warning') {
            return Swal.fire({
                title: title,
                text: text,
                icon: type,
                showCancelButton: true,
                confirmButtonColor: '#0073e6',
                cancelButtonColor: '#f44336',
                confirmButtonText: confirmText,
                cancelButtonText: 'Cancel'
            });
        }

        // Set active nav link
        function setActiveNavLink() {
            const currentPath = window.location.pathname;
            document.querySelectorAll('.nav-link-modern').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('bg-primary-100', 'text-primary-700', 'border-l-4', 'border-primary-600', 'font-semibold');
                } else {
                    link.classList.remove('bg-primary-100', 'text-primary-700', 'border-l-4', 'border-primary-600', 'font-semibold');
                }
            });
        }

        // Close dropdown on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setActiveNavLink();
        });
    </script>

    <!-- Page-specific JavaScript -->
    {% block extra_js %}{% endblock %}
</body>
</html>
