<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Receipt - OR #{{ payment.or_number }}</title>
    {% load static %}
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            font-size: 11px;
            line-height: 1.4;
            background: #f0f0f0;
        }
        .receipt {
            width: 90mm;
            max-width: 100%;
            margin: 10px auto;
            padding: 10px;
            background: #fff;
            border: 1px solid #000;
        }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .bold { font-weight: bold; }
        .uppercase { text-transform: uppercase; }

        /* Header with logos */
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border-bottom: 1px solid #000;
            padding-bottom: 5px;
            margin-bottom: 5px;
        }
        .header-logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
            flex-shrink: 0;
        }
        .header-text {
            text-align: center;
            padding: 0 3px;
        }
        .header-text p {
            margin: 0;
            line-height: 1.2;
        }
        .header-title {
            font-size: 12px;
            font-weight: bold;
            font-style: italic;
        }
        .header-subtitle {
            font-size: 9px;
        }
        .office-title {
            font-size: 10px;
            font-weight: bold;
            margin-top: 3px;
        }

        /* OR Number Section */
        .or-section {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #000;
            padding: 5px 0;
        }
        .or-left {
            font-size: 9px;
        }
        .or-right {
            text-align: right;
        }
        .or-number {
            font-size: 14px;
            font-weight: bold;
            color: #c00;
        }

        /* Date Section */
        .date-section {
            border-bottom: 1px solid #000;
            padding: 5px 0;
        }
        .date-row {
            display: flex;
            justify-content: space-between;
        }

        /* Payor Section */
        .payor-section {
            border-bottom: 1px solid #000;
            padding: 5px 0;
        }
        .payor-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        .payor-name {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 11px;
            text-align: center;
            padding: 3px 0;
        }
        .payor-address {
            text-align: center;
            font-size: 10px;
            text-transform: uppercase;
        }

        /* Collection Table */
        .collection-table {
            width: 100%;
            border-collapse: collapse;
            margin: 5px 0;
        }
        .collection-table th {
            background: #f5f5f5;
            border: 1px solid #000;
            padding: 3px;
            font-size: 9px;
            text-align: center;
        }
        .collection-table td {
            border: 1px solid #000;
            padding: 3px 5px;
            font-size: 10px;
        }
        .collection-table .amount {
            text-align: right;
        }
        .collection-table .empty-row td {
            height: 18px;
        }

        /* Total Section */
        .total-section {
            border-top: 2px solid #000;
            padding: 5px 0;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 12px;
        }
        .total-amount {
            font-size: 14px;
            color: #000;
        }

        /* Amount in Words */
        .words-section {
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            padding: 5px 0;
        }
        .words-label {
            font-size: 9px;
        }
        .words-value {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 10px;
            text-align: center;
            padding: 3px 0;
        }

        /* Payment Method */
        .payment-method {
            display: flex;
            border-bottom: 1px solid #000;
            padding: 5px 0;
            font-size: 9px;
        }
        .payment-options {
            width: 35%;
        }
        .payment-option {
            display: flex;
            align-items: center;
            margin: 2px 0;
        }
        .checkbox {
            width: 12px;
            height: 12px;
            border: 1px solid #000;
            margin-right: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .checkbox.checked::after {
            content: "✓";
            font-size: 10px;
        }
        .payment-details {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 3px;
            font-size: 8px;
            text-align: center;
        }
        .payment-details div {
            border-bottom: 1px solid #000;
            padding: 2px;
        }

        /* Signature Section */
        .signature-section {
            padding: 8px 0;
            text-align: center;
        }
        .signature-text {
            font-size: 9px;
            margin-bottom: 15px;
        }
        .signature-name {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 11px;
            border-top: 1px solid #000;
            padding-top: 3px;
            width: 60%;
            margin: 0 auto;
        }
        .signature-title {
            font-size: 9px;
            text-transform: uppercase;
        }

        /* Footer Note */
        .footer-note {
            font-size: 8px;
            border-top: 1px solid #000;
            padding-top: 5px;
            margin-top: 5px;
        }

        /* Action Buttons */
        .no-print {
            text-align: center;
            margin: 15px auto;
            max-width: 90mm;
        }
        .no-print button, .no-print a {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        .btn-print { background: #2563eb; color: #fff; }
        .btn-new { background: #16a34a; color: #fff; }

        @media print {
            body { background: #fff; margin: 0; padding: 0; }
            .receipt {
                width: 90mm;
                border: none;
                margin: 0;
                padding: 5px;
            }
            .no-print { display: none !important; }
        }
        @page {
            size: 90mm auto;
            margin: 2mm;
        }
    </style>
</head>
<body>
    <div class="receipt">
        <!-- Header with Logos -->
        <div class="header">
            <img src="{% static 'consumers/images/municipal.jpg' %}" alt="Municipal Seal" class="header-logo">
            <div class="header-text">
                <p class="header-title">OFFICIAL RECEIPT</p>
                <p class="header-subtitle">Republic of the Philippines</p>
                <p class="header-subtitle bold">OFFICE OF THE TREASURER</p>
                <p class="header-subtitle">Province of Bohol</p>
                <p class="office-title">MTO-BALILIHAN</p>
            </div>
            <img src="{% static 'consumers/images/water_icon.png' %}" alt="Waterworks Logo" class="header-logo">
        </div>

        <!-- OR Number Section -->
        <div class="or-section">
            <div class="or-left">
                <p>Accountable Form No. 51</p>
                <p>(Revised August 1994)</p>
            </div>
            <div class="or-right">
                <p style="font-size:9px;">OR <span style="font-size:8px;">SERIAL</span></p>
                <p class="or-number">{{ payment.or_number }}</p>
            </div>
        </div>

        <!-- Date Section -->
        <div class="date-section">
            <div class="date-row">
                <span>DATE</span>
                <span class="bold">{{ payment.payment_date|date:"F d, Y" }}</span>
            </div>
        </div>

        <!-- Payor Section -->
        <div class="payor-section">
            <div class="payor-row">
                <span>PAYOR</span>
                <span>FUND</span>
            </div>
            <p class="payor-name">{{ payment.bill.consumer.last_name }}, {{ payment.bill.consumer.first_name }}</p>
            <p class="payor-address">{{ payment.bill.consumer.barangay.name|default:"" }}, BALILIHAN, BOHOL</p>
        </div>

        <!-- Nature of Collection Table -->
        <table class="collection-table">
            <thead>
                <tr>
                    <th style="width:45%;">NATURE OF COLLECTION</th>
                    <th style="width:25%;">ACCOUNT<br>CODE</th>
                    <th style="width:30%;">AMOUNT</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>WATER BILL</td>
                    <td class="text-center">639</td>
                    <td class="amount">{{ payment.original_bill_amount|default:payment.bill.total_amount }}</td>
                </tr>
                <tr>
                    <td style="font-size:9px;">{{ payment.bill.billing_period|date:"F Y" }} ({{ breakdown.usage_type }})</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td style="font-size:9px;">Prev: {{ previous_reading_value }}m³ → Curr: {{ payment.bill.current_reading.reading_value }}m³</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td style="font-size:9px; font-weight:bold;">Consumption: {{ payment.bill.consumption }}m³</td>
                    <td></td>
                    <td></td>
                </tr>
                <!-- Tiered Rate Breakdown -->
                {% if breakdown.tier1_units > 0 %}
                <tr>
                    <td style="font-size:8px; padding-left:10px;">Tier 1 (1-5m³): Min charge</td>
                    <td></td>
                    <td style="font-size:8px; text-align:right;">₱{{ breakdown.tier1_amount }}</td>
                </tr>
                {% endif %}
                {% if breakdown.tier2_units > 0 %}
                <tr>
                    <td style="font-size:8px; padding-left:10px;">Tier 2 (6-10m³): {{ breakdown.tier2_units }}m³ × ₱{{ breakdown.tier2_rate }}</td>
                    <td></td>
                    <td style="font-size:8px; text-align:right;">₱{{ breakdown.tier2_amount }}</td>
                </tr>
                {% endif %}
                {% if breakdown.tier3_units > 0 %}
                <tr>
                    <td style="font-size:8px; padding-left:10px;">Tier 3 (11-20m³): {{ breakdown.tier3_units }}m³ × ₱{{ breakdown.tier3_rate }}</td>
                    <td></td>
                    <td style="font-size:8px; text-align:right;">₱{{ breakdown.tier3_amount }}</td>
                </tr>
                {% endif %}
                {% if breakdown.tier4_units > 0 %}
                <tr>
                    <td style="font-size:8px; padding-left:10px;">Tier 4 (21-50m³): {{ breakdown.tier4_units }}m³ × ₱{{ breakdown.tier4_rate }}</td>
                    <td></td>
                    <td style="font-size:8px; text-align:right;">₱{{ breakdown.tier4_amount }}</td>
                </tr>
                {% endif %}
                {% if breakdown.tier5_units > 0 %}
                <tr>
                    <td style="font-size:8px; padding-left:10px;">Tier 5 (51+m³): {{ breakdown.tier5_units }}m³ × ₱{{ breakdown.tier5_rate }}</td>
                    <td></td>
                    <td style="font-size:8px; text-align:right;">₱{{ breakdown.tier5_amount }}</td>
                </tr>
                {% endif %}
                {% if payment.penalty_amount > 0 %}
                <!-- Penalty Row -->
                <tr style="background-color: #fff5f5;">
                    <td style="color: #c00;">
                        <strong>LATE PAYMENT PENALTY</strong>
                        {% if payment.penalty_waived %}
                        <span style="color: #059669;">(WAIVED)</span>
                        {% endif %}
                    </td>
                    <td class="text-center">640</td>
                    <td class="amount" style="color: #c00;">
                        {% if payment.penalty_waived %}
                        <span style="text-decoration: line-through;">{{ payment.penalty_amount }}</span>
                        <span style="color: #059669;"> 0.00</span>
                        {% else %}
                        {{ payment.penalty_amount }}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td style="font-size:9px; color: #666;">
                        {{ payment.days_overdue_at_payment }} day{{ payment.days_overdue_at_payment|pluralize }} overdue
                        {% if payment.penalty_waived %}
                        - Waived by {{ payment.bill.penalty_waived_by.get_full_name|default:payment.bill.penalty_waived_by.username }}
                        {% endif %}
                    </td>
                    <td></td>
                    <td></td>
                </tr>
                {% else %}
                <tr class="empty-row">
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% endif %}
            </tbody>
        </table>

        <!-- Total Section -->
        <div class="total-section">
            {% if payment.penalty_amount > 0 and not payment.penalty_waived %}
            <div style="display: flex; justify-content: space-between; font-size: 10px; color: #666; margin-bottom: 3px;">
                <span>Subtotal (Bill)</span>
                <span>₱ {{ payment.original_bill_amount|default:payment.bill.total_amount }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; font-size: 10px; color: #c00; margin-bottom: 5px;">
                <span>Penalty</span>
                <span>₱ {{ payment.penalty_amount }}</span>
            </div>
            {% endif %}
            <div class="total-row">
                <span>TOTAL <span style="font-size:10px;">CASH</span></span>
                <span>₱ <span class="total-amount">{{ payment.amount_paid }}</span></span>
            </div>
        </div>

        <!-- Amount in Words -->
        <div class="words-section">
            <p class="words-label">AMOUNT IN WORDS</p>
            <p class="words-value">{{ payment.amount_in_words|default:"" }}</p>
        </div>

        <!-- Payment Method -->
        <div class="payment-method">
            <div class="payment-options">
                <div class="payment-option">
                    <span class="checkbox checked"></span>
                    <span>Cash</span>
                </div>
                <div class="payment-option">
                    <span class="checkbox"></span>
                    <span>Check</span>
                </div>
                <div class="payment-option">
                    <span class="checkbox"></span>
                    <span>Money Order</span>
                </div>
            </div>
            <div class="payment-details">
                <div>DRAWEE<br>BANK</div>
                <div>NUMBER</div>
                <div>DATE</div>
            </div>
        </div>

        <!-- Signature Section -->
        <div class="signature-section">
            <p class="signature-text">Received the amount stated above</p>
            <div class="signature-name">{{ request.user.get_full_name|default:request.user.username }}</div>
            <p class="signature-title">Revenue Collection Clerk</p>
        </div>

        <!-- Footer Note -->
        <div class="footer-note">
            <p>NOTE: Write the number and date of this receipt on the back of check or money order received.</p>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="no-print">
        <button class="btn-print" onclick="window.print()">Print Receipt</button>
        <a href="{% url 'consumers:inquire' %}" class="btn-new">New Payment</a>
    </div>
</body>
</html>
